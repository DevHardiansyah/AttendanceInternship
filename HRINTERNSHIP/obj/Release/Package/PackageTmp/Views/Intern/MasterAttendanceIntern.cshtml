@{
    ViewBag.Title = "Master Attendance Intern"; Layout = "~/Views/Shared/_DashboardIntern.cshtml";
}
<!--begin::Toolbar-->
<div class="toolbar" id="kt_toolbar">
    <!--begin::Container-->
    <div id="kt_toolbar_container" class="container-fluid d-flex flex-stack">
        <!--begin::Page title-->
        <div data-kt-swapper="true" data-kt-swapper-mode="prepend"
             data-kt-swapper-parent="{default: '#kt_content_container', 'lg': '#kt_toolbar_container'}"
             class="page-title d-flex align-items-center flex-wrap me-3 mb-5 mb-lg-0">
            <!--begin::Title-->
            <h1 class="d-flex align-items-center text-dark fw-bolder fs-3 my-1">
                Dashboard
                <!--begin::Separator-->
                <span class="h-20px border-gray-200 border-start ms-3 mx-2"></span>
                <!--end::Separator-->
                <!--begin::Description-->
                <small class="text-muted fs-7 fw-bold my-1 ms-1">@ViewBag.title</small>
                <!--end::Description-->
            </h1>
            <!--end::Title-->
        </div>
        <!--end::Page title-->
        <!--begin::Actions-->
        <div class="d-flex align-items-center py-1">
            <!--begin::Wrapper-->
            <div class="me-4">
                <!--begin::Menu-->
                <a href="#" class="btn btn-sm btn-flex btn-light btn-active-primary fw-bolder"
                   data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                    <!--begin::Svg Icon | path: icons/duotune/general/gen031.svg-->
                    <span class="svg-icon svg-icon-5 svg-icon-gray-500 me-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                             viewBox="0 0 24 24" fill="none">
                            <path d="M19.0759 3H4.72777C3.95892 3 3.47768 3.83148 3.86067 4.49814L8.56967 12.6949C9.17923 13.7559 9.5 14.9582 9.5 16.1819V19.5072C9.5 20.2189 10.2223 20.7028 10.8805 20.432L13.8805 19.1977C14.2553 19.0435 14.5 18.6783 14.5 18.273V13.8372C14.5 12.8089 14.8171 11.8056 15.408 10.964L19.8943 4.57465C20.3596 3.912 19.8856 3 19.0759 3Z"
                                  fill="black" />
                        </svg>
                    </span>
                    <!--end::Svg Icon-->Filter
                </a>
                <!--begin::Menu 1-->
                <div class="menu menu-sub menu-sub-dropdown w-250px w-md-300px" data-kt-menu="true"
                     id="kt_menu_61484bf44d957">
                    <!--begin::Header-->
                    <div class="px-7 py-5">
                        <div class="fs-5 text-dark fw-bolder">Filter Options</div>
                    </div>
                    <!--end::Header-->
                    <!--begin::Menu separator-->
                    <div class="separator border-gray-200"></div>
                    <!--end::Menu separator-->
                    <!--begin::Form-->
                    <div class="px-7 py-5">
                        <!--begin::Input group-->
                        <div class="mb-10">
                            <!--begin::Label-->
                            <label class="form-label fw-bold">Status:</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <div>
                                <select class="form-select form-select-solid" data-kt-select2="true"
                                        data-placeholder="Select option"
                                        data-dropdown-parent="#kt_menu_61484bf44d957"
                                        data-allow-clear="true">
                                    <option></option>
                                    <option value="1">Approved</option>
                                    <option value="2">Pending</option>
                                    <option value="2">In Process</option>
                                    <option value="2">Rejected</option>
                                </select>
                            </div>
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-10">
                            <!--begin::Label-->
                            <label class="form-label fw-bold">Member Type:</label>
                            <!--end::Label-->
                            <!--begin::Options-->
                            <div class="d-flex">
                                <!--begin::Options-->
                                <label class="form-check form-check-sm form-check-custom form-check-solid me-5">
                                    <input class="form-check-input" type="checkbox" value="1" />
                                    <span class="form-check-label">Author</span>
                                </label>
                                <!--end::Options-->
                                <!--begin::Options-->
                                <label class="form-check form-check-sm form-check-custom form-check-solid">
                                    <input class="form-check-input" type="checkbox" value="2"
                                           checked="checked" />
                                    <span class="form-check-label">Customer</span>
                                </label>
                                <!--end::Options-->
                            </div>
                            <!--end::Options-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-10">
                            <!--begin::Label-->
                            <label class="form-label fw-bold">Notifications:</label>
                            <!--end::Label-->
                            <!--begin::Switch-->
                            <div class="form-check form-switch form-switch-sm form-check-custom form-check-solid">
                                <input class="form-check-input" type="checkbox" value=""
                                       name="notifications" checked="checked" />
                                <label class="form-check-label">Enabled</label>
                            </div>
                            <!--end::Switch-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Actions-->
                        <div class="d-flex justify-content-end">
                            <button type="reset"
                                    class="btn btn-sm btn-light btn-active-light-primary me-2"
                                    data-kt-menu-dismiss="true">
                                Reset
                            </button>
                            <button type="submit" class="btn btn-sm btn-primary"
                                    data-kt-menu-dismiss="true">
                                Apply
                            </button>
                        </div>
                        <!--end::Actions-->
                    </div>
                    <!--end::Form-->
                </div>
                <!--end::Menu 1-->
                <!--end::Menu-->
            </div>
            <!--end::Wrapper-->
            <!--begin::Button-->
            <a href="#" class="btn btn-sm btn-primary" data-bs-toggle="modal"
               data-bs-target="#kt_modal_create_app" id="kt_toolbar_primary_button">Create</a>
            <!--end::Button-->
        </div>
        <!--end::Actions-->
    </div>
    <!--end::Container-->
</div>
<!--end::Toolbar-->
<!--begin::Post-->
<div class="post d-flex flex-column-fluid" id="kt_post">
    <!--begin::Container-->
    <div id="kt_content_container" class="container-xxl">
        <form action="#">
            <!--begin::Card-->
            <div class="card mb-7">
                <!--begin::Card body-->
                <div class="card-body">
                    <!--begin::Compact form-->
                    <div class="d-flex align-items-center">
                        <!--begin::Input group-->
                        <div class="position-relative w-md-400px me-md-2">
                            <!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
                            <span class="svg-icon svg-icon-3 svg-icon-gray-500 position-absolute top-50 translate-middle ms-6">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1" transform="rotate(45 17.0365 15.1223)" fill="currentColor" />
                                    <path d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z" fill="currentColor" />
                                </svg>
                            </span>
                            <!--end::Svg Icon-->
                            <input type="text" id="kpk_intern" value="" name="kpk" maxlength="6"
                                   oninput="javascript: if(this.value.length > this.max.length) this.value = this.value.slice(0, this.maxLength);"
                                   min="5" class="form-control form-control-solid ps-10" placeholder="Type KPK" />
                        </div>
                        <!--end::Input group-->
                        <!--begin:Action-->
                        <div class="d-flex align-items-center">
                            <button type="button" class="btn btn-primary me-5" id="btnSearch">Search</button>
                            <a id="kt_horizontal_search_advanced_link" class="btn btn-link" data-bs-toggle="collapse" href="#kt_advanced_search_form">Advanced Search</a>
                        </div>
                        <!--end:Action-->
                    </div>
                    <!--end::Compact form-->
                    <!--begin::Advance form-->
                    <div class="collapse" id="kt_advanced_search_form">
                        <!--begin::Separator-->
                        <div class="separator separator-dashed mt-9 mb-6"></div>
                        <!--end::Separator-->
                        <!--begin::Row-->
                        <div class="row g-8 mb-8">
                            <!--begin::Col-->
                            <div class="col-xxl-4">
                                <label class="fs-6 form-label fw-bolder text-dark">Intern Name</label>
                                <input type="text" id="internname" value="" name="internname" min="5"
                                       class="form-control" placeholder="Type Intern Name"
                                       autocomplete="off" oninput="this.value = this.value.toUpperCase()">
                            </div>
                            <div class="col-lg-3">
                                <label class="fs-6 form-label fw-bolder text-dark">Start Date</label>
                                <input type="date" name="FromDate" id="FromDate" class="form-control" value="" required />
                            </div>
                            <div class="col-lg-3">
                                <label class="fs-6 form-label fw-bolder text-dark">End Date</label>
                                <input type="date" name="ToDate" id="ToDate" class="form-control"
                                       value="" required />
                            </div>
                            <div class="col-lg-2">
                                <label class="fs-6 form-label fw-bolder text-dark">Status</label>
                                <select name="status_filter" id="status_filter" class="form-select">
                                    <option value="">All</option>
                                    <option value="Active">Active</option>
                                    <option value="EOC">Non-Active</option>
                                </select>
                            </div>
                            <!--end::Col-->
                        </div>
                        <!--end::Row-->
                    </div>
                    <!--end::Advance form-->
                </div>
                <!--end::Card body-->
            </div>
            <!--end::Card-->
        </form>
        <div class="row profile-body">
            <div class="col-xl-8 col-xl-12 middle-wrapper mt-3">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header bg-header">
                                <div class="card-title bg-header text-white text-center mb-0">
                                    <h4>Master Attendance Intern</h4>
                                </div>
                            </div>
                            <div class="card-body">
                                @if (TempData["AllertSuccess"] != null)
                                {
                                    <script type="text/javascript">
                                        window.onload = function () {
                                            Swal.fire({
                                                text: '@TempData["AllertSuccess"]',
                                                icon: "success",
                                                buttonsStyling: false,
                                                confirmButtonText: "Ok, got it!",
                                                customClass: {
                                                    confirmButton: "btn btn-primary"
                                                }
                                            });
                                        };
                                    </script>
                                }
                                @if (TempData["AllertError"] != null)
                                {
                                    <script type="text/javascript">
                                        window.onload = function () {
                                            Swal.fire({
                                                text: '@TempData["AllertError"]',
                                                icon: "error",
                                                buttonsStyling: false,
                                                confirmButtonText: "Ok, got it!",
                                                customClass: {
                                                    confirmButton: "btn btn-danger"
                                                }
                                            });
                                        };
                                    </script>
                                }
                                @if (Convert.ToDateTime(ViewBag.To) < DateTime.Now)
                                {
                                    <script type="text/javascript">
                                        window.onload = function () {
                                            Swal.fire({
                                                text: 'Perode is expired, Please set periode',
                                                icon: "error",
                                                buttonsStyling: false,
                                                confirmButtonText: "Ok, got it!",
                                                customClass: {
                                                    confirmButton: "btn btn-danger"
                                                }
                                            });
                                        };
                                    </script>
                                }
                                <!-- Button trigger modal create new hire-->
                                <div class="row">
                                    <div class="col-12">
                                        <button class="btn btn-primary position-relative mb-4" data-bs-toggle="collapse"
                                                data-bs-target="#collapseExample" aria-expanded="false"
                                                aria-controls="collapseExample" s>
                                            <i class="las la-calendar me-2 fs-2"></i>Set Periode
                                            @if (Convert.ToDateTime(ViewBag.To) < DateTime.Now)
                                            {
                                                <span class="spinner-grow spinner-grow-sm alert-danger position-absolute top-0 start-0 translate-middle" role="status"
                                                  aria-hidden="true"></span>
                                            }
                                        </button>
                                        <button class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#uploadModal" onclick="return uploadAttendance()">
                                            <i class="las la-cloud-upload-alt me-2 fs-2"></i>Uplaod Attendance
                                        </button>
                                        <button class="btn btn-success mb-4" id="download_attendance">
                                            <i class="las la-cloud-download-alt me-2 fs-2"></i>Download Attendance
                                        </button>
                                    </div>
                                </div>
                                <div class="col-6 mr-5">
                                    <div class="collapse" id="collapseExample" style="">
                                        <div class="card card-body">
                                            <div class="separator separator-dashed mt-9 mb-6"></div>
                                            <form action="/Intern/SetPeriode" id="frmPeriode" method="post">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <label>Start Date</label>
                                                        <input type="date" name="datefrom" class="form-control"
                                                               value="@ViewBag.From" />
                                                    </div>
                                                    <div class="col-6">
                                                        <label>End Date</label>
                                                        <input type="date" name="dateto" class="form-control"
                                                               value="@ViewBag.To" />
                                                    </div>
                                                </div>
                                                <div class="row mt-5">
                                                    <div class="col-12">
                                                        <button class="btn btn-primary btn-block" type="submit"
                                                                id="btnPeriode">
                                                            Generate
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" id="updateAttendance" tabindex="-1" role="dialog"
                                     aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="false"
                                     date-keyboard="false">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header bg-navy">
                                                <h5 class="modal-title" id="exampleModalLabel">Edit Attendance</h5>
                                                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
                                                    <span class="svg-icon svg-icon-2x">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                            <path opacity="0.3" d="M6.7 19.4L5.3 18C4.9 17.6 4.9 17 5.3 16.6L16.6 5.3C17 4.9 17.6 4.9 18 5.3L19.4 6.7C19.8 7.1 19.8 7.7 19.4 8.1L8.1 19.4C7.8 19.8 7.1 19.8 6.7 19.4Z" fill="currentColor" />
                                                            <path d="M19.5 18L18.1 19.4C17.7 19.8 17.1 19.8 16.7 19.4L5.40001 8.1C5.00001 7.7 5.00001 7.1 5.40001 6.7L6.80001 5.3C7.20001 4.9 7.80001 4.9 8.20001 5.3L19.5 16.6C19.9 16.9 19.9 17.6 19.5 18Z" fill="currentColor" />
                                                        </svg>
                                                    </span>
                                                </div>
                                            </div>
                                            <form action="#" method="post" enctype="multipart/form-data" id="frmAttendance">
                                                <div class="modal-body">
                                                    <div class="row">
                                                        <input type="hidden" name="kpk" id="kpk" value=""
                                                               class="form-control" />
                                                        <input type="hidden" name="date" id="date" value=""
                                                               class="form-control" />
                                                        <input type="hidden" name="atnid" id="atnid" value=""
                                                               class="form-control" />
                                                        <div class="col-6">
                                                            <div class="form-group">
                                                                <label>Clock IN</label>
                                                                <input class="form-control" data-inputmask="'alias': 'datetime'" data-inputmask-inputformat="HH:MM" placeholder="Clock IN (23:59)"
                                                                       name="clockin" id="clockin" autocomplete="off" value="" required />
                                                                @*<input type="text" name="clockin" id="clockin" value=""
                        class="form-control" placeholder="Clock In" />*@
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="form-group">
                                                                <label>Clock Out</label>
                                                                <input class="form-control" data-inputmask="'alias': 'datetime'" data-inputmask-inputformat="HH:MM"
                                                                       placeholder="Clock Out (23:59)"
                                                                       name="clockout" id="clockout" autocomplete="off" value="" required />
                                                                @*<input type="text" name="clockout" id="clockout" value=""
                        class="form-control" placeholder="Clock Out" />*@
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary btnCloseModal2"
                                                            data-bs-dismiss="modal">
                                                        Close
                                                    </button>
                                                    <button type="button" class="btn btn-primary" id="btnAttendance">
                                                        Save
                                                        changes
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-lg-12">
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="MasterAttendanceIntern">
                                                <thead>
                                                    <tr>
                                                        <th rowspan="2" class="text-center" width="30px">
                                                            <i data-feather="settings"></i>
                                                        </th>
                                                        <th rowspan="2" class="text-center" width="140px">
                                                            <i data-feather="calendar"></i>
                                                        </th>
                                                        <th class="text-center" rowspan="2" width="100px">
                                                            KPK
                                                        </th>
                                                        <th class="text-center" rowspan="2">
                                                            NAME
                                                        </th>
                                                        <th class="text-center" colspan="2">
                                                            Clock
                                                        </th>
                                                        <th class="text-center" rowspan="2">Work Hours</th>
                                                        <th class="text-center" rowspan="2">Status</th>
                                                        <th class="d-none" rowspan="2">Status Active</th>
                                                    </tr>
                                                    <tr>
                                                        <td class="text-center">IN</td>
                                                        <td class="text-center">Out</td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--end::Container-->
</div>
<!--end::Post-->
<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-navy">
                <h5 class="modal-title" id="exampleModalLabel">Upload Attendance</h5>
                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
                    <span class="svg-icon svg-icon-2x">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path opacity="0.3" d="M6.7 19.4L5.3 18C4.9 17.6 4.9 17 5.3 16.6L16.6 5.3C17 4.9 17.6 4.9 18 5.3L19.4 6.7C19.8 7.1 19.8 7.7 19.4 8.1L8.1 19.4C7.8 19.8 7.1 19.8 6.7 19.4Z" fill="currentColor" />
                            <path d="M19.5 18L18.1 19.4C17.7 19.8 17.1 19.8 16.7 19.4L5.40001 8.1C5.00001 7.7 5.00001 7.1 5.40001 6.7L6.80001 5.3C7.20001 4.9 7.80001 4.9 8.20001 5.3L19.5 16.6C19.9 16.9 19.9 17.6 19.5 18Z" fill="currentColor" />
                        </svg>
                    </span>
                </div>
            </div>
            <form action="#" method="post" enctype="multipart/form-data" id="frmUpload">
                <div class="modal-body">
                    <label class="mb-4">Upload</label><br />
                    <input type="file" name="postedFile" id="postedFile" required accept="text/plain" class="form-control" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" id="btnUpload">Upload</button>
                </div>
            </form>
        </div>
    </div>
</div>
<br>
<br>
<script>
    $(document).ready(function () {

        var min_date = $("#FromDate").val();
        var max_date = $("#ToDate").val();

        var t = $("#MasterAttendanceIntern").DataTable({
            searching: true,
            processing: true,
            scrollY: 670,
            scrollX: true,
            autoWidth: false,
            scrollCollapse: false,
            paging: false,
            order: false,
            dom: 'Bfrtip',
            buttons: [{
                extend: 'excelHtml5',
                customize: function (xlsx) {
                    var sheet = xlsx.xl.worksheets['sheet1.xml'];
                    $('row', sheet).each(function (x) {
                        if ($('c[r=G' + x + '] t', sheet).text() === 'ABS') {
                            $('row:nth-child(' + x + ') c', sheet).attr('s', '19');
                        }
                        else if ($('c[r=G' + x + '] t', sheet).text() === 'Public Holiday') {
                            $('row:nth-child(' + x + ') c', sheet).attr('s', '19');
                        }
                        else if ($('c[r=G' + x + '] t', sheet).text() === 'TIMEOFF') {
                            $('row:nth-child(' + x + ') c', sheet).attr('s', '35');
                        }
                    });
                }

            }],
            initComplete: function () {
                var btns = $('.dt-button');
                btns.addClass('btn  alert-primary d-none');
                btns.removeClass('dt-button');
                btns.text('Download Report')
            },
        });
        $("#download_attendance").click(function () {
            $("#MasterAttendanceIntern").table2excel({
                exclude: ".d-none",
                name: "Worksheet Name",
                filename: "Master Attendance",
                fileext: ".xlsx",
                columns: [1, 2, 3, 4, 5, 6, 7],
                preserveColors: true,
                exclude_img: true
            });
        });
        t.columns.adjust().draw();
        loadData(min_date, max_date);

        // function to load data
        function loadData(min_date, max_date) {
            swal.fire({
                title: "Loading...",
                text: "Please wait",
                icon: "/Content/images/icon/loading2.gif",
                button: false,
                showConfirmButton: false,
                allowOutsideClick: false
                //icon: "success"
            });
            t.columns(8).search("Active").draw();
            return $.ajax({
                url: "/Intern/ListAttendanceIntern?min_date=" + min_date + "&max_date=" + max_date,
                type: "GET",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (data) {
                    Swal.fire({
                        text: "Success Load Data",
                        icon: "success",
                        buttonsStyling: false,
                        confirmButtonText: "Ok, got it!",
                        customClass: {
                            confirmButton: "btn btn-primary"
                        }
                    });
                    var html = '';
                    var counter = 1;

                    // delete existing row if any
                    t.clear().draw();

                    $.each(data, function (key, item) {
                        var day = item.test;
                        var a = day.split(",")[1];
                        var strday = day.substring(0, 3);
                        var today = new Date();
                        var dd = String(today.getDate()).padStart(2, '0');
                        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                        var yyyy = today.getFullYear();
                        var today = mm + '/' + dd + '/' + yyyy;

                        var currdate = new Date(today)
                        var cmpdate = new Date(a)

                        if (strday == "Sat") {
                            html += '<tr class="itemRow bg-grey text-black">';
                            html += '<td><button type="button" class="btn btn-rounded btn-sm btn-primary btn_editRow" data-bs-toggle="modal" data-bs-target="#updateAttendance">Edit</button>';
                            html += '<td>' + item.test + '</td>';
                            html += '<td class="text-center">' + item.KPK + '</td>';
                            html += '<input type="hidden" class="KPKValue" name="KPKValue" value="' + item.KPK + '" />'
                            html += '<td>' + item.Cardholder_Name + '</td>';
                            html += '<input type="hidden" class="Cardholder_Name" name="Cardholder_Name" value="' + item.Cardholder_Name + '" />'
                            if (item.ClockIn == null) {
                                html += '<td class="text-center"></td>';
                                html += '<input type="hidden" class="ClockInValue" name="ClockInValue" value="" />'
                            }
                            else {
                                html += '<td class="text-center">' + item.ClockIn + '</td>';
                                html += '<input type="hidden" class="ClockInValue" name="ClockInValue" value="' + item.ClockIn + '" />'
                            }
                            if (item.ClockOut == null) {
                                html += '<td class="text-center"></td>';
                                html += '<input type="hidden" class="ClockOutValue" name="ClockOutValue" value="" />'
                            }
                            else {
                                html += '<td class="text-center">' + item.ClockOut + '</td>';
                                html += '<input type="hidden" class="ClockOutValue" name="ClockOutValue" value="' + item.ClockOut + '" />'
                            }
                            if (item.total_hour == null) {
                                html += '<td class="text-center"></td>';
                            }
                            else {
                                html += '<td class="text-center">' + item.total_hour + ' Hours</td>';
                            }
                            if (item.Entry_Date_Time == null && item.Entry_Out != null) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">No Clock IN</span></td>';
                            }
                            else if (item.Entry_Date_Time != null && item.Entry_Out == null) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">No Clock Out</span></td>';
                            }
                            else if (item.Entry_Date_Time == null && item.Entry_Out == null && item.Date_public_holidays != null) {
                                html += '<td class="text-center "><span class="badge  badge-light-warning">Public Holiday</span></td>';
                            }
                            else if (item.Entry_Date_Time != null && item.Entry_Out != null) {
                                html += '<td class="text-center "><span class="badge badge-light-success">ATN</span></td>';
                            }
                            else {
                                html += '<td class="text-center text-bold">REST DAY</td>';
                            }
                            if (item.STATUS == "Active") {
                                html += '<td class="d-none">' + item.STATUS + '</td>';
                            }
                            else {
                                html += '<td class="d-none">EOC</td>';
                            }
                            html += '<input type="hidden" class="DateValue" name="DateValue" value="' + a + '" />'
                            html += '<input type="hidden" class="AtnValue" name="AtnValue" value="' + item.Attendance_id + '" />'
                            html += '</tr>';
                            counter++;
                        }
                        else if (strday == "Sun") {
                            html += '<tr class="itemRow bg-grey text-black">';
                            html += '<td><button type="button" class="btn btn-rounded btn-sm btn-primary btn_editRow" data-bs-toggle="modal" data-bs-target="#updateAttendance">Edit</button>';
                            html += '<td>' + item.test + '</td>';
                            html += '<td class="text-center">' + item.KPK + '</td>';
                            html += '<input type="hidden" class="KPKValue" name="KPKValue" value="' + item.KPK + '" />'
                            html += '<td>' + item.Cardholder_Name + '</td>';
                            html += '<input type="hidden" class="Cardholder_Name" name="Cardholder_Name" value="' + item.Cardholder_Name + '" />'
                            if (item.ClockIn == null) {
                                html += '<td class="text-center"></td>';
                                html += '<input type="hidden" class="ClockInValue" name="ClockInValue" value="" />'
                            }
                            else {
                                html += '<td class="text-center">' + item.ClockIn + '</td>';
                                html += '<input type="hidden" class="ClockInValue" name="ClockInValue" value="' + item.ClockIn + '" />'
                            }
                            if (item.ClockOut == null) {
                                html += '<td class="text-center"></td>';
                                html += '<input type="hidden" class="ClockOutValue" name="ClockOutValue" value="" />'
                            }
                            else {
                                html += '<td class="text-center">' + item.ClockOut + '</td>';
                                html += '<input type="hidden" class="ClockOutValue" name="ClockOutValue" value="' + item.ClockOut + '" />'
                            }
                            if (item.total_hour == null) {
                                html += '<td class="text-center"></td>';
                            }
                            else {
                                html += '<td class="text-center">' + item.total_hour + ' Hours</td>';
                            }
                            if (item.Entry_Date_Time == null && item.Entry_Out != null) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">No Clock IN</span></td>';
                            }
                            else if (item.Entry_Date_Time != null && item.Entry_Out == null) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">No Clock Out</span></td>';
                            }
                            else if (item.Entry_Date_Time == null && item.Entry_Out == null && item.Date_public_holidays != null) {
                                html += '<td class="text-center "><span class="badge  badge-light-warning">Public Holiday</span></td>';
                            }
                            else if (item.Entry_Date_Time != null && item.Entry_Out != null) {
                                html += '<td class="text-center "><span class="badge badge-light-success">ATN</span></td>';
                            }
                            else {
                                html += '<td class="text-center text-bold">REST DAY</td>';
                            }
                            if (item.STATUS == "Active") {
                                html += '<td class="d-none">' + item.STATUS + '</td>';
                            }
                            else {
                                html += '<td class="d-none">EOC</td>';
                            }
                            html += '<input type="hidden" class="DateValue" name="DateValue" value="' + a + '" />'
                            html += '<input type="hidden" class="AtnValue" name="AtnValue" value="' + item.Attendance_id + '" />'
                            html += '</tr>';
                            counter++;
                        }
                        else if (item.ClockIn == null || item.ClockIn == null) {
                            html += '<tr class="itemRow">';
                            html += '<td><button type="button" class="btn btn-rounded btn-sm btn-primary btn_editRow" data-bs-toggle="modal" data-bs-target="#updateAttendance">Edit</button>';
                            html += '<td>' + item.test + '</td>';
                            html += '<td class="text-center">' + item.KPK + '</td>';
                            html += '<input type="hidden" class="KPKValue" name="KPKValue" value="' + item.KPK + '" />'
                            html += '<td>' + item.Cardholder_Name + '</td>';
                            html += '<input type="hidden" class="Cardholder_Name" name="Cardholder_Name" value="' + item.Cardholder_Name + '" />'
                            if (item.ClockIn == null) {
                                html += '<td class="text-center"></td>';
                                html += '<input type="hidden" class="ClockInValue" name="ClockInValue" value="" />'
                            }
                            else {
                                html += '<td class="text-center">' + item.ClockIn + '</td>';
                                html += '<input type="hidden" class="ClockInValue" name="ClockInValue" value="' + item.ClockIn + '" />'
                            }
                            if (item.ClockOut == null) {
                                html += '<td class="text-center"></td>';
                                html += '<input type="hidden" class="ClockOutValue" name="ClockOutValue" value="" />'
                            }
                            else {
                                html += '<td class="text-center">' + item.ClockOut + '</td>';
                                html += '<input type="hidden" class="ClockOutValue" name="ClockOutValue" value="' + item.ClockOut + '" />'
                            }
                            if (item.total_hour == null) {
                                html += '<td class="text-center"></td>';
                            }
                            else {
                                html += '<td class="text-center">' + item.total_hour + ' Hours</td>';
                            }
                            if (item.Entry_Date_Time == null && item.Entry_Out != null) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">No Clock IN</span></td>';
                            }
                            else if (item.Entry_Date_Time != null && item.Entry_Out == null) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">No Clock Out</span></td>';
                            }
                            else if (item.Entry_Date_Time == null && item.Entry_Out == null && item.Date_public_holidays == null && cmpdate <= currdate) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">ABS</span></td>';
                            }
                            else if (item.Entry_Date_Time == null && item.Entry_Out == null && item.Date_public_holidays != null) {
                                html += '<td class="text-center "><span class="badge  badge-light-warning">Public Holiday</span></td>';
                            }
                            else {
                                html += '<td class="text-center "></td>';
                            }
                            if (item.STATUS == "Active") {
                                html += '<td class="d-none">' + item.STATUS + '</td>';
                            }
                            else {
                                html += '<td class="d-none">EOC</td>';
                            }
                            html += '<td class="d-none">' + item.STATUS + '</td>';
                            html += '<input type="hidden" class="DateValue" name="DateValue" value="' + a + '" />'
                            html += '<input type="hidden" class="AtnValue" name="AtnValue" value="' + item.Attendance_id + '" />'
                            html += '</tr>';
                            counter++;
                        }
                        else {
                            html += '<tr class="itemRow text-black">';
                            html += '<td><button type="button" class="btn btn-rounded btn-sm btn-primary btn_editRow" data-bs-toggle="modal" data-bs-target="#updateAttendance">Edit</button>';
                            html += '<td>' + item.test + '</td>';
                            html += '<td class="text-center">' + item.KPK + '</td>';
                            html += '<input type="hidden" class="KPKValue" name="KPKValue" value="' + item.KPK + '" />'
                            html += '<td>' + item.Cardholder_Name + '</td>';
                            html += '<input type="hidden" class="Cardholder_Name" name="Cardholder_Name" value="' + item.Cardholder_Name + '" />'
                            if (item.ClockIn == null) {
                                html += '<td class="text-center"></td>';
                                html += '<input type="hidden" class="ClockInValue" name="ClockInValue" value="" />'
                            }
                            else {
                                html += '<td class="text-center">' + item.ClockIn + '</td>';
                                html += '<input type="hidden" class="ClockInValue" name="ClockInValue" value="' + item.ClockIn + '" />'
                            }
                            if (item.ClockOut == null) {
                                html += '<td class="text-center"></td>';
                                html += '<input type="hidden" class="ClockOutValue" name="ClockOutValue" value="" />'
                            }
                            else {
                                html += '<td class="text-center">' + item.ClockOut + '</td>';
                                html += '<input type="hidden" class="ClockOutValue" name="ClockOutValue" value="' + item.ClockOut + '" />'
                            }
                            if (item.total_hour == null) {
                                html += '<td class="text-center"></td>';
                            }
                            else {
                                html += '<td class="text-center">' + item.total_hour + ' Hours</td>';
                            }
                            if (item.Entry_Date_Time == null && item.Entry_Out != null) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">No Clock IN</span></td>';
                            }
                            else if (item.Entry_Date_Time != null && item.Entry_Out == null) {
                                html += '<td class="text-center "><span class="badge badge-light-danger">No Clock Out</span></td>';
                            }
                            else {
                                html += '<td class="text-center "><span class="badge badge-light-success">ATN</span></td>';
                            }
                            if (item.STATUS == "Active") {
                                html += '<td class="d-none">' + item.STATUS + '</td>';
                            }
                            else {
                                html += '<td class="d-none">EOC</td>';
                            }

                            html += '<input type="hidden" class="DateValue" name="DateValue" value="' + a + '" />'
                            html += '<input type="hidden" class="AtnValue" name="AtnValue" value="' + item.Attendance_id + '" />'
                            html += '</tr>';
                            counter++;
                        }
                    });

                    t.rows.add($(html)).draw();
                    t.columns.adjust().draw();
                },
                error: function (textStatus, status) {
                    console.log(textStatus);
                    console.log(status);
                    swal("Oops...!", 'Something went wrong!', "error");
                    console.log(xhr.responseText);
                    console.log(xhr.statusText);
                    console.log(textStatus);
                    console.log(error);
                }
            });
        }

        // Display value for selected item to be edited
        $(document).on("click", ".btn_editRow", function (e) {
            $('#updateAttendance').modal({
                backdrop: 'static',
                keyboard: false
            });
            e.preventDefault();

            var self = $(this);
            var kpkvalue = self.closest("tr").find("input[name='KPKValue']").val();
            var datevalue = self.closest("tr").find("input[name='DateValue']").val();
            var clockinvalue = self.closest("tr").find("input[name='ClockInValue']").val();
            var clockoutvalue = self.closest("tr").find("input[name='ClockOutValue']").val();
            var atnvalue = self.closest("tr").find("input[name='AtnValue']").val();

            var strclockinvalue = clockinvalue.substring(0, 5);
            var strclockoutvalue = clockoutvalue.substring(0, 5);
            // assigning object value to the field
            $('.modal-title').html('Update Attendance ' + datevalue + '');

            $("#kpk").val(kpkvalue);
            $("#date").val(datevalue);
            $("#clockin").val(strclockinvalue);
            $("#clockout").val(strclockoutvalue);
            $("#atnid").val(atnvalue);

            $('.modal-dialog').addClass('modal-sm');
            $('.modal-dialog').removeClass('modal-sm');
            $('#btnAttendance').html('Update');
            $('.hapus').addClass('d-none');
            $('.input').removeClass('d-none');

            $('#btnAttendance').click(function () {
                $("#updateAttendance").modal('hide');
                var kpkupdate = $("#kpk").val();
                var atnid = $("#atnid").val();
                var dateupdate = $("#date").val();
                var clockinupdate = $("#clockin").val();
                var clockoutupdate = $("#clockout").val();

                $.ajax({
                    url: "/Intern/UpdateAttendance?kpk=" + kpkupdate + "&date=" + dateupdate + "&clockin=" + clockinupdate + "&clockout=" + clockoutupdate + "&atnid=" + atnid,
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    dataType: "json",
                    success: function () {
                        loadData(min_date, max_date);
                    },
                    error: function (xhr, textStatus, error) {
                        Swal.fire({
                            text: "You have sucessfully update attendance",
                            icon: "success",
                            buttonsStyling: false,
                            confirmButtonText: "Ok, got it!",
                            customClass: {
                                confirmButton: "btn btn-primary"
                            }
                        });
                    }
                });
            });
        });
        $("#kpk_intern").keyup(function () {
            t.columns(2).search(this.value).draw();
        });
        $("#internname").keyup(function () {
            t.columns(3).search(this.value).draw();
        });
        $('#status_filter').on('change', function () {
            t.columns(8).search(this.value).draw();
        });
        $('#btnSearch').click(function () {
            loadData($("#FromDate").val(), $("#ToDate").val());
        });
    });
    // function UploadAttendance
    function uploadAttendance() {
        $('#uploadModal').modal({
            backdrop: false,
            keyboard: false
        });
        $('.modal-title').html('Upload Attendance');

        $('[name="postedFile"]').attr("required", "required");

        $('.modal-dialog').addClass('modal-sm');
        $('.modal-dialog').removeClass('modal-sm');
        $('#btnactivity').html('Save');
        $('.hapus').addClass('d-none');
        $('.input').removeClass('d-none');
        $('#frmUpload').attr('action', '/Intern/Upload');
        $('#btnUpload').click(function () {
            var input = document.getElementById("postedFile");
            var max_img_size = 1048576;
            // check for browser support (may need to be modified)
            if (input.files && input.files.length == 1) {
                if (input.files[0].size > max_img_size) {
                    swal("Oops...!", "The file must be less than " + (max_img_size / 1024 / 1024) + "MB", "error");
                    return false;
                }
            }
            swal({
                title: "Upload...",
                text: "Please wait",
                icon: "/Content/images/icon/loading2.gif",
                button: false,
                showConfirmButton: false,
                allowOutsideClick: false
                //icon: "success"
            });
        });
    }
</script>
<!--  Page end  end-->
